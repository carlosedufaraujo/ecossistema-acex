<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConfiPro Analytics - Ecossistema Acex</title>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1e293b;
            --light: #f1f5f9;
            --white: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: linear-gradient(to bottom right, #f8fafc, #e0e7ff, #ddd6fe);
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 16px 0;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 16px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }
        
        .header p {
            color: #64748b;
            font-size: 14px;
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 16px;
        }
        
        /* Cenários */
        .cenarios-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        
        .cenarios-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cenarios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .cenario-btn {
            padding: 16px;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            background: rgba(255, 255, 255, 0.7);
        }
        
        .cenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .cenario-btn.pessimista {
            border-color: #fca5a5;
            background: #fef2f2;
            color: #991b1b;
        }
        
        .cenario-btn.realista {
            border-color: #93c5fd;
            background: #eff6ff;
            color: #1e40af;
        }
        
        .cenario-btn.otimista {
            border-color: #86efac;
            background: #f0fdf4;
            color: #166534;
        }
        
        .cenario-btn.active {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: scale(1.05);
        }
        
        .cenario-label {
            font-size: 14px;
            font-weight: 600;
            text-transform: capitalize;
            margin-bottom: 4px;
        }
        
        .cenario-preco {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .cenario-resultado {
            font-size: 20px;
            font-weight: 800;
        }
        
        /* Layout Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 24px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 4px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-helper {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        /* Resultado Principal */
        .resultado-card {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            text-align: center;
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        
        .resultado-card.negative {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .resultado-label {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .resultado-value {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 8px;
        }
        
        .resultado-info {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* KPIs Grid */
        .kpis-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .kpis-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .kpi-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .kpi-label {
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .kpi-value {
            font-size: 24px;
            font-weight: 900;
        }
        
        /* Custos Grid */
        .custos-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .custos-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .custo-item {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .custo-label {
            color: #64748b;
        }
        
        .custo-detail {
            display: block;
            font-size: 11px;
            color: #94a3b8;
            margin-top: 2px;
        }
        
        .custo-value {
            font-weight: 600;
        }
        
        .custo-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
            font-weight: 700;
        }
        
        /* Faixa Rialma Alert */
        .faixa-alert {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .faixa-title {
            font-size: 12px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 4px;
        }
        
        .faixa-info {
            font-size: 12px;
            color: #3730a3;
            margin-bottom: 8px;
        }
        
        .faixa-warning {
            background: #fef3c7;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }
        
        .faixa-warning-title {
            font-size: 12px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 4px;
        }
        
        .faixa-warning-detail {
            font-size: 11px;
            color: #78350f;
        }
        
        .faixa-success {
            font-size: 12px;
            color: #059669;
        }
        
        /* Resumo Financeiro */
        .resumo-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
            font-size: 14px;
        }
        
        .breakdown-section {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
        }
        
        .breakdown-title {
            font-weight: 700;
            color: #475569;
            margin-bottom: 8px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .breakdown-label {
            color: #64748b;
        }
        
        .breakdown-value {
            font-weight: 600;
        }
        
        /* Totais */
        .total-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 12px;
        }
        
        .total-item.red {
            background: #fee2e2;
        }
        
        .total-item.green {
            background: #dcfce7;
        }
        
        .total-item.result {
            border: 2px solid;
        }
        
        .total-item.result.positive {
            background: #dcfce7;
            border-color: #bbf7d0;
        }
        
        .total-item.result.negative {
            background: #fee2e2;
            border-color: #fecaca;
        }
        
        .total-label {
            font-weight: 700;
        }
        
        .total-detail {
            display: block;
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .total-value {
            font-size: 18px;
            font-weight: 900;
        }
        
        /* Projeções */
        .projecoes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .projecoes-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .projecao-card {
            text-align: center;
            padding: 24px;
            border-radius: 12px;
        }
        
        .projecao-card.indigo {
            background: #e0e7ff;
            border: 1px solid #c7d2fe;
        }
        
        .projecao-card.green {
            background: #dcfce7;
            border: 1px solid #bbf7d0;
        }
        
        .projecao-card.purple {
            background: #f3e8ff;
            border: 1px solid #e9d5ff;
        }
        
        .projecao-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .projecao-value {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 4px;
        }
        
        .projecao-info {
            font-size: 11px;
            opacity: 0.7;
        }
        
        /* Projeção Total */
        .projecao-total {
            background: linear-gradient(135deg, #3b82f6, #4f46e5);
            color: white;
            padding: 24px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .projecao-total-left {
            flex: 1;
        }
        
        .projecao-total-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .projecao-total-value {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 4px;
        }
        
        .projecao-total-info {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .projecao-total-right {
            text-align: right;
        }
        
        .projecao-total-label {
            font-size: 12px;
            opacity: 0.75;
            margin-bottom: 4px;
        }
        
        .projecao-total-secondary {
            font-size: 18px;
            font-weight: 700;
        }
        
        /* Timeline */
        .timeline-container {
            background: #f8fafc;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
        }
        
        .timeline-title {
            font-size: 14px;
            font-weight: 700;
            color: #475569;
            margin-bottom: 12px;
        }
        
        .timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .timeline-point {
            text-align: center;
        }
        
        .timeline-label {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .timeline-date {
            font-size: 11px;
            color: #64748b;
        }
        
        .timeline-peso {
            font-size: 12px;
            font-weight: 500;
        }
        
        .timeline-line {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .timeline-bar {
            height: 2px;
            background: #cbd5e1;
            flex: 1;
        }
        
        .timeline-dias {
            margin: 0 12px;
            text-align: center;
        }
        
        .timeline-dias-value {
            font-size: 12px;
            font-weight: 600;
            color: #7c3aed;
        }
        
        .timeline-dias-label {
            font-size: 11px;
            color: #94a3b8;
        }
        
        /* Performance Grid */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .performance-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .performance-item {
            text-align: center;
            padding: 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .performance-label {
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .performance-value {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        
        .performance-info {
            font-size: 11px;
            color: #94a3b8;
        }
        
        /* Utility Classes */
        .text-emerald { color: #10b981; }
        .text-red { color: #ef4444; }
        .text-blue { color: #3b82f6; }
        .text-purple { color: #7c3aed; }
        .text-orange { color: #f59e0b; }
        .text-indigo { color: #4f46e5; }
        
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        
        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            text-decoration: none;
            color: #475569;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-bottom: 24px;
        }
        
        .back-button:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>ConfiPro Analytics</h1>
            <p>Sistema Pecuário • Rialma S.A • Cenário: <span id="cenarioAtivo" style="font-weight: 600;">Realista</span></p>
        </div>
    </div>
    
    <div class="container">
        <!-- Back Button -->
        <a href="dashboard.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
            Voltar ao Dashboard
        </a>
        <!-- Botão Salvar Análise -->
<button onclick="salvarAnalise()" style="
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: #10b981;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-left: 16px;
    transition: all 0.2s ease;
">
    <i class="fas fa-save"></i>
    Salvar Análise
</button>

<button onclick="verHistorico()" style="
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-left: 8px;
    transition: all 0.2s ease;
">
    <i class="fas fa-history"></i>
    Ver Histórico
</button>
        
        <!-- Análise de Cenários -->
        <div class="cenarios-card">
            <h3 class="cenarios-title">
                <i class="fas fa-chart-bar text-purple"></i>
                Análise de Cenários de Mercado
            </h3>
            
            <div class="cenarios-grid">
                <div class="cenario-btn pessimista" onclick="mudarCenario('pessimista')">
                    <i class="fas fa-trending-down"></i>
                    <div class="cenario-label">Pessimista</div>
                    <div class="cenario-preco" id="precoPessimista">-</div>
                    <div class="cenario-resultado text-red" id="resultadoPessimista">-</div>
                </div>
                
                <div class="cenario-btn realista active" onclick="mudarCenario('realista')">
                    <i class="fas fa-minus"></i>
                    <div class="cenario-label">Realista</div>
                    <div class="cenario-preco" id="precoRealista">-</div>
                    <div class="cenario-resultado text-blue" id="resultadoRealista">-</div>
                </div>
                
                <div class="cenario-btn otimista" onclick="mudarCenario('otimista')">
                    <i class="fas fa-trending-up"></i>
                    <div class="cenario-label">Otimista</div>
                    <div class="cenario-preco" id="precoOtimista">-</div>
                    <div class="cenario-resultado text-emerald" id="resultadoOtimista">-</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; font-size: 12px;">
                <div style="text-align: center; padding: 8px; background: #fee2e2; border-radius: 8px;">
                    <span style="font-weight: 600; color: #991b1b;">Pessimista:</span> Preço venda -15%
                </div>
                <div style="text-align: center; padding: 8px; background: #dbeafe; border-radius: 8px;">
                    <span style="font-weight: 600; color: #1e40af;">Realista:</span> Preço base inserido
                </div>
                <div style="text-align: center; padding: 8px; background: #d1fae5; border-radius: 8px;">
                    <span style="font-weight: 600; color: #065f46;">Otimista:</span> Preço venda +15%
                </div>
            </div>
        </div>
        
        <div class="main-grid">
            <!-- Painel de Inputs -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Dados Básicos -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-calculator text-blue"></i>
                        Dados Básicos
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Preço Compra (R$/@)</label>
                            <input type="number" class="form-control" id="precoCompra" value="290" onchange="calcular()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Preço Venda (R$/@)</label>
                            <input type="number" class="form-control" id="precoVenda" value="350" onchange="calcular()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Peso Inicial (kg)</label>
                            <input type="number" class="form-control" id="pesoInicial" value="330" onchange="calcular()">
                            <div class="form-helper" id="pesoInicialArrobaVivo">0@ vivo</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Peso Final (kg)</label>
                            <input type="number" class="form-control" id="pesoFinal" value="450" onchange="calcular()">
                            <div class="form-helper" id="pesoFinalArrobaVivo">0@ vivo</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ganho Peso Projetado (kg/dia)</label>
                        <input type="number" step="0.1" class="form-control" id="ganhoPesoProjetado" value="1.4" onchange="calcular()">
                        <div class="form-helper" id="diasCochoInfo">0 dias calculados</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Rendimento Esperado (%)</label>
                        <input type="number" step="0.1" class="form-control" id="rendimentoEsperado" value="54.0" onchange="calcular()">
                        <div class="form-helper" id="pesoMortoArrobaInfo">0@ carcaça</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Data de Entrada</label>
                        <input type="date" class="form-control" id="dataEntrada" value="2025-05-10" onchange="calcular()">
                        <div class="form-helper" id="dataSaidaInfo">Saída: -</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Quantidade Total</label>
                            <input type="number" class="form-control" id="quantidade" value="1500" onchange="calcular()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Comissão (%)</label>
                            <input type="number" step="0.1" class="form-control" id="percentualComissao" value="1.0" onchange="calcular()">
                        </div>
                    </div>
                </div>
                
                <!-- Logística e Operação -->
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-truck text-orange"></i>
                        Logística e Operação
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Distância (km)</label>
                            <input type="number" class="form-control" id="distanciaKm" value="500" onchange="calcular()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Preço/km (R$)</label>
                            <input type="number" step="0.01" class="form-control" id="precoKm" value="7" onchange="calcular()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Qtd por Carreta</label>
                        <input type="number" class="form-control" id="quantidadePorCarreta" value="70" onchange="calcular()">
                        <div class="form-helper" id="custoFreteInfo">Frete: -/animal</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Protocolo Sanitário (R$)</label>
                        <input type="number" step="0.01" class="form-control" id="protocoloSanitario" value="14.00" onchange="calcular()">
                    </div>
                </div>
            </div>
            
            <!-- Dashboard -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Resultado Principal -->
                <div id="resultadoCard" class="resultado-card">
                    <div class="resultado-label">
                        <i class="fas fa-bullseye"></i>
                        RESULTADO POR ANIMAL
                    </div>
                    <div class="resultado-value" id="resultadoPrincipal">-</div>
                    <div class="resultado-info">
                        <span id="cenarioInfo">Cenário realista</span> • <span id="diasCochoResultado">0</span> dias
                    </div>
                    <div class="resultado-info" style="font-size: 12px; opacity: 0.75; margin-top: 8px;">
                        Entrada: <span id="dataEntradaResultado">-</span> → Saída: <span id="dataSaidaResultado">-</span>
                    </div>
                </div>
                
                <!-- KPIs -->
                <div class="kpis-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">MARGEM</div>
                        <div class="kpi-value text-emerald" id="kpiMargem">0%</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">PESO GANHO</div>
                        <div class="kpi-value text-purple" id="kpiPesoGanho">0kg</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">@ GANHAS</div>
                        <div class="kpi-value text-indigo" id="kpiArrobasGanhas">0</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">DIAS CICLO</div>
                        <div class="kpi-value text-blue" id="kpiDiasCiclo">0</div>
                    </div>
                </div>
                
                <!-- Detalhamento de Custos -->
                <div class="custos-grid">
                    <!-- Custos de Aquisição -->
                    <div class="card">
                        <h4 class="card-title" style="font-size: 16px;">
                            <i class="fas fa-box text-blue"></i>
                            Custos de Aquisição
                        </h4>
                        
                        <div style="margin-bottom: 12px;">
                            <div class="custo-item">
                                <div>
                                    <div class="custo-label">Aquisição Animal</div>
                                    <div class="custo-detail" id="aquisicaoDetalhe">0@ × R$ 0</div>
                                </div>
                                <div class="custo-value text-blue" id="custoAquisicaoAnimal">-</div>
                            </div>
                            
                            <div class="custo-item">
                                <div class="custo-label">Frete</div>
                                <div class="custo-value text-orange" id="custoFrete">-</div>
                            </div>
                            
                            <div class="custo-item">
                                <div class="custo-label">Comissão (<span id="comissaoPercent">0</span>%)</div>
                                <div class="custo-value text-yellow" id="custoComissao">-</div>
                            </div>
                        </div>
                        
                        <div class="custo-total">
                            <span style="color: #1e40af;">TOTAL</span>
                            <span style="color: #1e40af;" id="totalCustosAquisicao">-</span>
                        </div>
                    </div>
                    
                    <!-- Custos Operacionais -->
                    <div class="card">
                        <h4 class="card-title" style="font-size: 16px;">
                            <i class="fas fa-utensils text-emerald"></i>
                            Custos Operacionais
                        </h4>
                        
                        <!-- Faixa Rialma Info -->
                        <div id="faixaAlert" class="faixa-alert" style="display: none;">
                            <div class="faixa-title" id="faixaTitulo">-</div>
                            <div class="faixa-info" id="faixaInfo">-</div>
                            <div id="faixaStatus"></div>
                        </div>
                        
                        <div style="margin-bottom: 12px;">
                            <div class="custo-item">
                                <div>
                                    <div class="custo-label">Alimentação</div>
                                    <div class="custo-detail" id="alimentacaoDetalhe">0 dias × R$ 0</div>
                                </div>
                                <div class="custo-value text-emerald" id="custoAlimentacao">-</div>
                            </div>
                            
                            <div class="custo-item">
                                <div class="custo-label">Protocolo Sanitário</div>
                                <div class="custo-value text-purple" id="custoProtocolo">-</div>
                            </div>
                        </div>
                        
                        <div class="custo-total">
                            <span style="color: #065f46;">TOTAL</span>
                            <span style="color: #065f46;" id="totalCustosOperacionais">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- Resumo Financeiro -->
                <div class="card">
                    <h4 class="card-title">
                        <i class="fas fa-chart-bar text-purple"></i>
                        Resumo Financeiro Detalhado
                    </h4>
                    
                    <div class="resumo-breakdown">
                        <div class="breakdown-section">
                            <div class="breakdown-title">Composição de Custos:</div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Aquisição:</span>
                                <span class="breakdown-value" id="percentAquisicao">0%</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Operacional:</span>
                                <span class="breakdown-value" id="percentOperacional">0%</span>
                            </div>
                        </div>
                        
                        <div class="breakdown-section">
                            <div class="breakdown-title">Análise por Arroba:</div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Custo/@ produzida:</span>
                                <span class="breakdown-value" id="custoArrobaProduzida">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Receita/@ vendida:</span>
                                <span class="breakdown-value" id="receitaArrobaVendida">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px;">
                        <div class="total-item red">
                            <div>
                                <div class="total-label" style="color: #991b1b;">CUSTO TOTAL</div>
                                <div class="total-detail">Aquisição + Operacional</div>
                            </div>
                            <div class="total-value text-red" id="custoTotal">-</div>
                        </div>
                        
                        <div class="total-item green">
                            <div>
                                <div class="total-label" style="color: #065f46;">RECEITA BRUTA</div>
                                <div class="total-detail">
                                    <span id="receitaDetalhe">0@ × R$ 0 (0% rendimento)</span>
                                </div>
                            </div>
                            <div class="total-value text-emerald" id="receitaBruta">-</div>
                        </div>
                        
                        <div id="resultadoLiquidoCard" class="total-item result positive">
                            <div>
                                <div class="total-label" id="resultadoLiquidoLabel">RESULTADO LÍQUIDO</div>
                                <div class="total-detail">Margem: <span id="margemResultado">0%</span></div>
                            </div>
                            <div class="total-value" id="resultadoLiquido">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Projeções Operacionais -->
                <div class="card">
                    <h4 class="card-title">
                        <i class="fas fa-trending-up text-indigo"></i>
                        Projeções Operacionais
                    </h4>
                    
                    <div class="projecoes-grid">
                        <div class="projecao-card indigo">
                            <div class="projecao-label" style="color: #4f46e5;">GIROS/ANO</div>
                            <div class="projecao-value" style="color: #4338ca;" id="girosAno">0</div>
                            <div class="projecao-info" style="color: #4f46e5;"><span id="diasCochoProjecao">0</span> dias/ciclo</div>
                        </div>
                        
                        <div class="projecao-card green">
                            <div class="projecao-label" style="color: #059669;">RESULTADO ANUAL</div>
                            <div class="projecao-value" style="color: #047857;" id="resultadoAnual">-</div>
                            <div class="projecao-info" style="color: #059669;">Por animal</div>
                        </div>
                        
                        <div class="projecao-card purple">
                            <div class="projecao-label" style="color: #7c3aed;">RENTABILIDADE</div>
                            <div class="projecao-value" style="color: #6d28d9;" id="rentabilidadeMensal">0%</div>
                            <div class="projecao-info" style="color: #7c3aed;">Ao mês</div>
                        </div>
                    </div>
                    
                    <!-- Projeção Total do Rebanho -->
                    <div class="projecao-total">
                        <div class="projecao-total-left">
                            <div class="projecao-total-title">
                                <i class="fas fa-users"></i>
                                Projeção Total do Rebanho
                            </div>
                            <div class="projecao-total-value" id="projecaoTotalRebanho">-</div>
                            <div class="projecao-total-info">
                                <span id="quantidadeRebanho">0</span> cabeças/ano • <span id="girosRebanho">0</span> giros
                            </div>
                        </div>
                        <div class="projecao-total-right">
                            <div class="projecao-total-label">Por giro:</div>
                            <div class="projecao-total-secondary" id="resultadoPorGiro">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Performance e Dados Técnicos -->
                <div class="card">
                    <h4 class="card-title">
                        <i class="fas fa-calendar text-gray-600"></i>
                        Performance e Dados Técnicos
                    </h4>
                    
                    <!-- Timeline -->
                    <div class="timeline-container">
                        <div class="timeline-title">Timeline do Processo:</div>
                        <div class="timeline">
                            <div class="timeline-point">
                                <div class="timeline-label text-blue">ENTRADA</div>
                                <div class="timeline-date" id="timelineEntrada">-</div>
                                <div class="timeline-peso" id="timelinePesoEntrada">0kg</div>
                            </div>
                            
                            <div class="timeline-line">
                                <div class="timeline-bar"></div>
                                <div class="timeline-dias">
                                    <div class="timeline-dias-value" id="timelineDias">0 DIAS</div>
                                    <div class="timeline-dias-label">confinamento</div>
                                </div>
                                <div class="timeline-bar"></div>
                            </div>
                            
                            <div class="timeline-point">
                                <div class="timeline-label text-emerald">SAÍDA</div>
                                <div class="timeline-date" id="timelineSaida">-</div>
                                <div class="timeline-peso" id="timelinePesoSaida">0kg</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Métricas de Performance -->
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">GANHO TOTAL</div>
                            <div class="performance-value text-purple" id="perfGanhoTotal">0kg</div>
                            <div class="performance-info" id="perfArrobasGanhas">0@ vivo</div>
                        </div>
                        
                        <div class="performance-item">
                            <div class="performance-label">PESO CARCAÇA</div>
                            <div class="performance-value text-emerald" id="perfPesoCarcaca">0kg</div>
                            <div class="performance-info" id="perfArrobasMorto">0@ morto</div>
                        </div>
                        
                        <div class="performance-item">
                            <div class="performance-label">RENDIMENTO</div>
                            <div class="performance-value text-blue" id="perfRendimento">0%</div>
                            <div class="performance-info">carcaça</div>
                        </div>
                        
                        <div class="performance-item">
                            <div class="performance-label">GANHO/DIA</div>
                            <div class="performance-value text-orange" id="perfGanhoDia">0kg</div>
                            <div class="performance-info">projetado</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tabela de diárias do confinamento Rialma
        const tabelaDiarias = [
            { pesoMin: 270, pesoMax: 285, diasLimite: 120, diaria: 14.70, diariaAposLimite: 17.63 },
            { pesoMin: 285, pesoMax: 300, diasLimite: 120, diaria: 15.11, diariaAposLimite: 18.13 },
            { pesoMin: 300, pesoMax: 315, diasLimite: 120, diaria: 15.48, diariaAposLimite: 18.57 },
            { pesoMin: 315, pesoMax: 330, diasLimite: 120, diaria: 16.02, diariaAposLimite: 19.23 },
            { pesoMin: 330, pesoMax: 345, diasLimite: 110, diaria: 16.28, diariaAposLimite: 19.54 },
            { pesoMin: 345, pesoMax: 360, diasLimite: 110, diaria: 16.82, diariaAposLimite: 20.18 },
            { pesoMin: 360, pesoMax: 375, diasLimite: 110, diaria: 17.28, diariaAposLimite: 20.74 },
            { pesoMin: 375, pesoMax: 390, diasLimite: 100, diaria: 17.46, diariaAposLimite: 20.96 },
            { pesoMin: 390, pesoMax: 405, diasLimite: 100, diaria: 17.92, diariaAposLimite: 21.51 },
            { pesoMin: 405, pesoMax: 420, diasLimite: 100, diaria: 18.38, diariaAposLimite: 22.06 },
            { pesoMin: 420, pesoMax: 435, diasLimite: 100, diaria: 18.83, diariaAposLimite: 22.60 },
            { pesoMin: 435, pesoMax: 450, diasLimite: 95, diaria: 19.14, diariaAposLimite: 22.96 },
            { pesoMin: 450, pesoMax: 465, diasLimite: 95, diaria: 19.58, diariaAposLimite: 23.50 },
            { pesoMin: 465, pesoMax: 480, diasLimite: 95, diaria: 20.02, diariaAposLimite: 24.02 },
            { pesoMin: 480, pesoMax: 495, diasLimite: 95, diaria: 20.31, diariaAposLimite: 24.38 },
            { pesoMin: 495, pesoMax: 510, diasLimite: 95, diaria: 20.74, diariaAposLimite: 24.89 }
        ];
        
        // Estado
        let cenarioAtivo = 'realista';
        let cenarios = {};
        let resultadoAtual = {};
        
        // Funções de formatação
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2
            }).format(Math.abs(value));
        }
        
        function formatNumber(value, decimals = 2) {
            return new Intl.NumberFormat('pt-BR', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(value);
        }
        
        // Encontrar faixa de peso
        function encontrarFaixaPeso(peso) {
            return tabelaDiarias.find(faixa => peso >= faixa.pesoMin && peso <= faixa.pesoMax);
        }
        
        // Calcular resultados
        function calcularResultados(precoVendaCustom = null) {
            // Obter valores dos inputs
            const dados = {
                precoCompra: parseFloat(document.getElementById('precoCompra').value) || 0,
                precoVenda: precoVendaCustom || parseFloat(document.getElementById('precoVenda').value) || 0,
                pesoInicial: parseFloat(document.getElementById('pesoInicial').value) || 0,
                pesoFinal: parseFloat(document.getElementById('pesoFinal').value) || 0,
                ganhoPesoProjetado: parseFloat(document.getElementById('ganhoPesoProjetado').value) || 0,
                rendimentoEsperado: parseFloat(document.getElementById('rendimentoEsperado').value) || 0,
                dataEntrada: document.getElementById('dataEntrada').value,
                quantidade: parseFloat(document.getElementById('quantidade').value) || 0,
                percentualComissao: parseFloat(document.getElementById('percentualComissao').value) || 0,
                distanciaKm: parseFloat(document.getElementById('distanciaKm').value) || 0,
                precoKm: parseFloat(document.getElementById('precoKm').value) || 0,
                quantidadePorCarreta: parseFloat(document.getElementById('quantidadePorCarreta').value) || 0,
                protocoloSanitario: parseFloat(document.getElementById('protocoloSanitario').value) || 0
            };
            
            // Conversões básicas
            const pesoInicialArrobaVivo = dados.pesoInicial / 30;
            const pesoFinalArrobaVivo = dados.pesoFinal / 30;
            const ganhoDeWeight = dados.pesoFinal - dados.pesoInicial;
            const arrobasGanhas = ganhoDeWeight / 30;
            
            // Dias de Cocho
            const diasCocho = dados.ganhoPesoProjetado > 0 ? 
                Math.round(ganhoDeWeight / dados.ganhoPesoProjetado) : 0;
            
            // Custos de Aquisição
            const custoAquisicaoAnimal = pesoInicialArrobaVivo * dados.precoCompra;
            const custoFrete = dados.quantidadePorCarreta > 0 ? 
                (dados.distanciaKm * 2 * dados.precoKm) / dados.quantidadePorCarreta : 0;
            const custoComissao = custoAquisicaoAnimal * (dados.percentualComissao / 100);
            const custosAquisicao = custoAquisicaoAnimal + custoFrete + custoComissao;
            
            // Custos Operacionais
            const faixa = encontrarFaixaPeso(dados.pesoInicial);
            let custoAlimentacao = 0;
            let diasExcedentes = 0;
            let custoPorDia = 14.80;
            let diasLimite = 95;
            
            if (faixa) {
                custoPorDia = faixa.diaria;
                diasLimite = faixa.diasLimite;
                
                if (diasCocho <= diasLimite) {
                    custoAlimentacao = diasCocho * faixa.diaria;
                    diasExcedentes = 0;
                } else {
                    const diasNormais = diasLimite;
                    diasExcedentes = diasCocho - diasLimite;
                    
                    const custoAlimentacaoNormal = diasNormais * faixa.diaria;
                    const custoAlimentacaoExcedente = diasExcedentes * faixa.diariaAposLimite;
                    custoAlimentacao = custoAlimentacaoNormal + custoAlimentacaoExcedente;
                }
            } else {
                custoAlimentacao = diasCocho * custoPorDia;
            }
            
            const custosOperacionais = custoAlimentacao + dados.protocoloSanitario;
            
            // Totais
            const custoTotal = custosAquisicao + custosOperacionais;
            
            // Receita
            const pesoMortoKg = dados.pesoFinal * (dados.rendimentoEsperado / 100);
            const pesoMortoArroba = pesoMortoKg / 15;
            const faturamento = pesoMortoArroba * dados.precoVenda;
            
            // Resultado
            const resultado = faturamento - custoTotal;
            
            // Data da venda
            const dataEntrada = new Date(dados.dataEntrada);
            const dataVenda = new Date(dataEntrada);
            dataVenda.setDate(dataEntrada.getDate() + diasCocho);
            
            // Métricas
            const lucroPercentual = custoTotal > 0 ? (resultado / custoTotal) * 100 : 0;
            const girosAno = diasCocho > 0 ? 365 / diasCocho : 0;
            const lucroMensal = diasCocho > 0 ? (lucroPercentual / diasCocho) * 30 : 0;
            const resultadoGiroAnual = resultado * girosAno;
            const resultadoGiroAnualQtd = resultadoGiroAnual * dados.quantidade;
            
            // Análises específicas
            const custoArrobaProduzida = arrobasGanhas > 0 ? 
                (custoAlimentacao + dados.protocoloSanitario) / arrobasGanhas : 0;
            const margemArrobaVendida = dados.precoVenda - custoArrobaProduzida;
            
            return {
                dados,
                faixa,
                
                // Pesos
                pesoInicialArrobaVivo,
                pesoFinalArrobaVivo,
                pesoMortoKg,
                pesoMortoArroba,
                ganhoDeWeight,
                arrobasGanhas,
                diasCocho,
                diasLimite,
                diasExcedentes,
                custoPorDia,
                
                // Custos
                custoAquisicaoAnimal,
                custoFrete,
                custoComissao,
                custosAquisicao,
                custoAlimentacao,
                custosOperacionais,
                custoArrobaProduzida,
                margemArrobaVendida,
                custoTotal,
                
                // Receita e Resultado
                faturamento,
                resultado,
                
                // Métricas
                lucroPercentual,
                lucroMensal,
                girosAno,
                resultadoGiroAnual,
                resultadoGiroAnualQtd,
                dataVenda: dataVenda.toLocaleDateString('pt-BR')
            };
        }
        
        // Atualizar interface
        function atualizarInterface(resultado) {
            // Helpers nas inputs
            document.getElementById('pesoInicialArrobaVivo').textContent = 
                formatNumber(resultado.pesoInicialArrobaVivo, 2) + '@ vivo';
            document.getElementById('pesoFinalArrobaVivo').textContent = 
                formatNumber(resultado.pesoFinalArrobaVivo, 2) + '@ vivo';
            document.getElementById('diasCochoInfo').textContent = 
                resultado.diasCocho + ' dias calculados';
            document.getElementById('pesoMortoArrobaInfo').textContent = 
                formatNumber(resultado.pesoMortoArroba, 2) + '@ carcaça';
            document.getElementById('dataSaidaInfo').textContent = 
                'Saída: ' + resultado.dataVenda;
            document.getElementById('custoFreteInfo').textContent = 
                'Frete: ' + formatCurrency(resultado.custoFrete) + '/animal';
            
            // Resultado Principal
            const resultadoCard = document.getElementById('resultadoCard');
            const isPositive = resultado.resultado > 0;
            resultadoCard.className = isPositive ? 'resultado-card' : 'resultado-card negative';
            document.getElementById('resultadoPrincipal').textContent = formatCurrency(resultado.resultado);
            document.getElementById('cenarioInfo').textContent = 'Cenário ' + cenarioAtivo;
            document.getElementById('diasCochoResultado').textContent = resultado.diasCocho;
            document.getElementById('dataEntradaResultado').textContent = resultado.dados.dataEntrada;
            document.getElementById('dataSaidaResultado').textContent = resultado.dataVenda;
            
            // KPIs
            document.getElementById('kpiMargem').textContent = formatNumber(resultado.lucroPercentual, 1) + '%';
            document.getElementById('kpiMargem').className = 'kpi-value ' + (resultado.lucroPercentual > 0 ? 'text-emerald' : 'text-red');
            document.getElementById('kpiPesoGanho').textContent = resultado.ganhoDeWeight + 'kg';
            document.getElementById('kpiArrobasGanhas').textContent = formatNumber(resultado.arrobasGanhas, 2);
            document.getElementById('kpiDiasCiclo').textContent = resultado.diasCocho;
            
            // Custos de Aquisição
            document.getElementById('aquisicaoDetalhe').textContent = 
                formatNumber(resultado.pesoInicialArrobaVivo, 2) + '@ × ' + formatCurrency(resultado.dados.precoCompra);
            document.getElementById('custoAquisicaoAnimal').textContent = formatCurrency(resultado.custoAquisicaoAnimal);
            document.getElementById('custoFrete').textContent = formatCurrency(resultado.custoFrete);
            document.getElementById('comissaoPercent').textContent = resultado.dados.percentualComissao;
            document.getElementById('custoComissao').textContent = formatCurrency(resultado.custoComissao);
            document.getElementById('totalCustosAquisicao').textContent = formatCurrency(resultado.custosAquisicao);
            
            // Faixa Rialma
            if (resultado.faixa) {
                document.getElementById('faixaAlert').style.display = 'block';
                document.getElementById('faixaTitulo').textContent = 
                    'Faixa Rialma: ' + resultado.faixa.pesoMin + '-' + resultado.faixa.pesoMax + 'kg';
                document.getElementById('faixaInfo').textContent = 
                    'Diária normal: ' + formatCurrency(resultado.faixa.diaria) + ' • Limite: ' + resultado.faixa.diasLimite + ' dias';
                
                const faixaStatus = document.getElementById('faixaStatus');
                if (resultado.diasExcedentes > 0) {
                    faixaStatus.innerHTML = `
                        <div class="faixa-warning">
                            <div class="faixa-warning-title">⚠️ ATENÇÃO: Ultrapassou ${resultado.diasExcedentes} dias</div>
                            <div class="faixa-warning-detail">
                                • ${resultado.diasCocho - resultado.diasExcedentes} dias normais: ${formatCurrency(resultado.faixa.diaria)}/dia<br>
                                • ${resultado.diasExcedentes} dias extras: ${formatCurrency(resultado.faixa.diariaAposLimite)}/dia
                            </div>
                        </div>
                    `;
                } else {
                    faixaStatus.innerHTML = `
                        <div class="faixa-success">
                            ✅ Dentro do limite (${resultado.diasCocho}/${resultado.faixa.diasLimite} dias)
                        </div>
                    `;
                }
            } else {
                document.getElementById('faixaAlert').style.display = 'none';
            }
            
            // Custos Operacionais
            let alimentacaoDetalhe = resultado.diasCocho + ' dias × ' + formatCurrency(resultado.custoPorDia);
            if (resultado.diasExcedentes > 0) {
                alimentacaoDetalhe += '<br><span class="text-orange">(' + 
                    (resultado.diasCocho - resultado.diasExcedentes) + ' normais + ' + 
                    resultado.diasExcedentes + ' extras)</span>';
            }
            document.getElementById('alimentacaoDetalhe').innerHTML = alimentacaoDetalhe;
            document.getElementById('custoAlimentacao').textContent = formatCurrency(resultado.custoAlimentacao);
            document.getElementById('custoProtocolo').textContent = formatCurrency(resultado.dados.protocoloSanitario);
            document.getElementById('totalCustosOperacionais').textContent = formatCurrency(resultado.custosOperacionais);
            
            // Resumo Financeiro
            const percentAquisicao = resultado.custoTotal > 0 ? 
                (resultado.custosAquisicao / resultado.custoTotal) * 100 : 0;
            const percentOperacional = resultado.custoTotal > 0 ? 
                (resultado.custosOperacionais / resultado.custoTotal) * 100 : 0;
            
            document.getElementById('percentAquisicao').textContent = formatNumber(percentAquisicao, 1) + '%';
            document.getElementById('percentOperacional').textContent = formatNumber(percentOperacional, 1) + '%';
            document.getElementById('custoArrobaProduzida').textContent = formatCurrency(resultado.custoArrobaProduzida);
            
            const receitaArrobaVendida = resultado.pesoMortoArroba > 0 ? 
                resultado.faturamento / resultado.pesoMortoArroba : 0;
            document.getElementById('receitaArrobaVendida').textContent = formatCurrency(receitaArrobaVendida);
            
            document.getElementById('custoTotal').textContent = formatCurrency(resultado.custoTotal);
            document.getElementById('receitaDetalhe').textContent = 
                formatNumber(resultado.pesoMortoArroba, 2) + '@ × ' + 
                formatCurrency(resultado.dados.precoVenda) + ' (' + 
                resultado.dados.rendimentoEsperado + '% rendimento)';
            document.getElementById('receitaBruta').textContent = formatCurrency(resultado.faturamento);
            
            const resultadoLiquidoCard = document.getElementById('resultadoLiquidoCard');
            resultadoLiquidoCard.className = 'total-item result ' + (isPositive ? 'positive' : 'negative');
            document.getElementById('resultadoLiquidoLabel').style.color = isPositive ? '#065f46' : '#991b1b';
            document.getElementById('resultadoLiquido').textContent = formatCurrency(resultado.resultado);
            document.getElementById('resultadoLiquido').className = 'total-value ' + (isPositive ? 'text-emerald' : 'text-red');
            document.getElementById('margemResultado').textContent = formatNumber(resultado.lucroPercentual, 1) + '%';
            
            // Projeções
            document.getElementById('girosAno').textContent = formatNumber(resultado.girosAno, 1);
            document.getElementById('diasCochoProjecao').textContent = resultado.diasCocho;
            document.getElementById('resultadoAnual').textContent = formatCurrency(resultado.resultadoGiroAnual);
            document.getElementById('rentabilidadeMensal').textContent = formatNumber(resultado.lucroMensal, 1) + '%';
            
            document.getElementById('projecaoTotalRebanho').textContent = formatCurrency(resultado.resultadoGiroAnualQtd);
            document.getElementById('quantidadeRebanho').textContent = formatNumber(resultado.dados.quantidade, 0);
            document.getElementById('girosRebanho').textContent = formatNumber(resultado.girosAno, 1);
            document.getElementById('resultadoPorGiro').textContent = 
                formatCurrency(resultado.resultado * resultado.dados.quantidade);
            
            // Timeline
            document.getElementById('timelineEntrada').textContent = resultado.dados.dataEntrada;
            document.getElementById('timelinePesoEntrada').textContent = resultado.dados.pesoInicial + 'kg';
            document.getElementById('timelineDias').textContent = resultado.diasCocho + ' DIAS';
            document.getElementById('timelineSaida').textContent = resultado.dataVenda;
            document.getElementById('timelinePesoSaida').textContent = resultado.dados.pesoFinal + 'kg';
            
            // Performance
            document.getElementById('perfGanhoTotal').textContent = resultado.ganhoDeWeight + 'kg';
            document.getElementById('perfArrobasGanhas').textContent = formatNumber(resultado.arrobasGanhas, 2) + '@ vivo';
            document.getElementById('perfPesoCarcaca').textContent = formatNumber(resultado.pesoMortoKg, 1) + 'kg';
            document.getElementById('perfArrobasMorto').textContent = formatNumber(resultado.pesoMortoArroba, 2) + '@ morto';
            document.getElementById('perfRendimento').textContent = resultado.dados.rendimentoEsperado + '%';
            document.getElementById('perfGanhoDia').textContent = resultado.dados.ganhoPesoProjetado + 'kg';
        }
        
        // Calcular todos os cenários
        function calcularTodosCenarios() {
            const precoBase = parseFloat(document.getElementById('precoVenda').value) || 0;
            
            cenarios = {
                pessimista: calcularResultados(precoBase * 0.85),
                realista: calcularResultados(precoBase),
                otimista: calcularResultados(precoBase * 1.15)
            };
            
            // Atualizar botões de cenário
            document.getElementById('precoPessimista').textContent = formatCurrency(precoBase * 0.85) + '/@';
            document.getElementById('resultadoPessimista').textContent = formatCurrency(cenarios.pessimista.resultado);
            
            document.getElementById('precoRealista').textContent = formatCurrency(precoBase) + '/@';
            document.getElementById('resultadoRealista').textContent = formatCurrency(cenarios.realista.resultado);
            
            document.getElementById('precoOtimista').textContent = formatCurrency(precoBase * 1.15) + '/@';
            document.getElementById('resultadoOtimista').textContent = formatCurrency(cenarios.otimista.resultado);
            
            // Atualizar interface com cenário ativo
            resultadoAtual = cenarios[cenarioAtivo];
            atualizarInterface(resultadoAtual);
        }
        
        // Mudar cenário
        function mudarCenario(tipo) {
            cenarioAtivo = tipo;
            document.getElementById('cenarioAtivo').textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1);
            
            // Atualizar botões
            document.querySelectorAll('.cenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.cenario-btn.' + tipo).classList.add('active');
            
            // Atualizar resultados
            resultadoAtual = cenarios[tipo];
            atualizarInterface(resultadoAtual);
        }
        
        // Função principal de cálculo
        function calcular() {
            calcularTodosCenarios();
        }
        
        // Verificar login
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
        // Configuração do Supabase (adicionar se não existir)
const SUPABASE_URL = 'https://yidrgpisaoaymlygjiha.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlpZHJncGlzYW9heW1seWdqaWhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYxOTE4NzMsImV4cCI6MjA1MTc2Nzg3M30.2P6lsCrn-QmSxFNhbBBrNs0T7muLXlOYNjB1RQQDtto';
const { createClient } = supabase;
const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Função para salvar análise
async function salvarAnalise() {
    // Verificar se há uma análise para salvar
    if (!resultadoAtual || !resultadoAtual.resultado) {
        Swal.fire({
            icon: 'warning',
            title: 'Atenção!',
            text: 'Faça uma simulação antes de salvar!',
            confirmButtonColor: '#3b82f6'
        });
        return;
    }
    
    // Pedir descrição para a análise
    const { value: descricao } = await Swal.fire({
        title: 'Salvar Análise',
        input: 'text',
        inputLabel: 'Dê um nome para esta análise:',
        inputPlaceholder: 'Ex: Análise Lote Janeiro 2025',
        showCancelButton: true,
        confirmButtonText: 'Salvar',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#10b981',
        inputValidator: (value) => {
            if (!value) {
                return 'Você precisa dar um nome para a análise!'
            }
        }
    });
    
    if (descricao) {
        try {
            // Preparar dados para salvar
            const analiseData = {
                codigo: 'ANALISE-' + Date.now(),
                descricao: descricao,
                cenario: cenarioAtivo,
                preco_compra: resultadoAtual.dados.precoCompra,
                preco_venda: resultadoAtual.dados.precoVenda,
                peso_inicial: resultadoAtual.dados.pesoInicial,
                peso_final: resultadoAtual.dados.pesoFinal,
                ganho_peso_projetado: resultadoAtual.dados.ganhoPesoProjetado,
                rendimento_esperado: resultadoAtual.dados.rendimentoEsperado,
                quantidade: resultadoAtual.dados.quantidade,
                distancia_km: resultadoAtual.dados.distanciaKm,
                preco_km: resultadoAtual.dados.precoKm,
                protocolo_sanitario: resultadoAtual.dados.protocoloSanitario,
                dias_cocho: resultadoAtual.diasCocho,
                resultado_animal: resultadoAtual.resultado,
                margem_percentual: resultadoAtual.lucroPercentual,
                resultado_total: resultadoAtual.resultado * resultadoAtual.dados.quantidade
            };
            
            // Salvar no Supabase
            const { data, error } = await supabaseClient
                .from('analise_confinamento')
                .insert([analiseData]);
                
            if (!error) {
                Swal.fire({
                    icon: 'success',
                    title: 'Sucesso!',
                    text: 'Análise salva com sucesso!',
                    confirmButtonColor: '#10b981'
                });
            } else {
                throw error;
            }
        } catch (error) {
            console.error('Erro ao salvar:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro!',
                text: 'Erro ao salvar análise. Tente novamente.',
                confirmButtonColor: '#ef4444'
            });
        }
    }
}

// Função para ver histórico
function verHistorico() {
    window.location.href = 'historico-analises.html';
}
        // Inicializar
        window.addEventListener('load', () => {
            // Definir data padrão
            const hoje = new Date();
            document.getElementById('dataEntrada').valueAsDate = hoje;
            
            // Calcular inicial
            calcular();
        });
    </script>
</body>
</html>
